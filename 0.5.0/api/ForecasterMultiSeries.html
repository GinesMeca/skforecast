
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Python library that eases using scikit-learn regressors as multi-step forecasters. It also works with any regressor compatible with the scikit-learn API (XGBoost, LightGBM, Ranger...).">
      
      
        <meta name="author" content="Joaquin Amat Rodrigo and Javier Escobar Ortiz">
      
      
        <link rel="canonical" href="https://joaquinamatrodrigo.github.io/skforecast/0.5.0/api/ForecasterMultiSeries.html">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.5.3">
    
    
      
        <title>ForecasterMultiSeries - Skforecast Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7a952b86.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#7e56c2">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,700,700i%7CUbuntu+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Ubuntu";--md-code-font:"Ubuntu Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-GR8X9Z9LKL"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-GR8X9Z9LKL",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-GR8X9Z9LKL",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>

  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="deep-purple" data-md-color-accent="light-blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#forecasterautoregmultiseries" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest version.
  <a href="../..">
    <strong>Click here to go to latest.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Skforecast Docs" class="md-header__button md-logo" aria-label="Skforecast Docs" data-md-component="logo">
      
  <img src="../img/logo_skforecast_white_no_background.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Skforecast Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ForecasterMultiSeries
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/JoaquinAmatRodrigo/skforecast" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../index.html" class="md-tabs__link">
        Home
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../quick-start/introduction-forecasting.html" class="md-tabs__link">
        Quick start
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../user_guides/input-data.html" class="md-tabs__link">
        User Guides
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../examples/examples.html" class="md-tabs__link">
        Examples and tutorials
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="ForecasterAutoreg.html" class="md-tabs__link md-tabs__link--active">
        API Reference
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../faq/non-negative-predictions.html" class="md-tabs__link">
        FAQ and Tips
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../releases/releases.html" class="md-tabs__link">
      Releases
    </a>
  </li>

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Skforecast Docs" class="md-nav__button md-logo" aria-label="Skforecast Docs" data-md-component="logo">
      
  <img src="../img/logo_skforecast_white_no_background.png" alt="logo">

    </a>
    Skforecast Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/JoaquinAmatRodrigo/skforecast" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Home
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Home" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Home
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Welcome to skforecast
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../quick-start/introduction-forecasting.html" class="md-nav__link">
        Quick start
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user_guides/input-data.html" class="md-nav__link">
        User Guides
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/examples.html" class="md-nav__link">
        Examples and tutorials
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="ForecasterAutoreg.html" class="md-nav__link">
        API Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../faq/faq.html" class="md-nav__link">
        FAQ and Tips
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../releases/releases.html" class="md-nav__link">
        Releases
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Quick start
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Quick start" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Quick start
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../quick-start/introduction-forecasting.html" class="md-nav__link">
        Introduction to forecasting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user_guides/quick-start-skforecast.html" class="md-nav__link">
        Quick start skforecast
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          User Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="User Guides" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          User Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user_guides/input-data.html" class="md-nav__link">
        Input data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user_guides/autoregresive-forecaster.html" class="md-nav__link">
        Recursive multi-step forecasting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user_guides/direct-multi-step-forecasting.html" class="md-nav__link">
        Direct multi-step forecasting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user_guides/multi-time-series-forecasting.html" class="md-nav__link">
        Multi-time series forecasting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user_guides/autoregresive-forecaster-exogenous.html" class="md-nav__link">
        Exogenous variables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user_guides/custom-predictors.html" class="md-nav__link">
        Custom predictors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user_guides/backtesting.html" class="md-nav__link">
        Backtesting forecaster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user_guides/hyperparameter-tuning-and-lags-selection.html" class="md-nav__link">
        Hyperparameter tuning and lags selection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user_guides/sklearn-transformers-and-pipeline.html" class="md-nav__link">
        Scikit-learn Transformers and Pipelines
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user_guides/prediction-intervals.html" class="md-nav__link">
        Prediction intervals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user_guides/feature-importance.html" class="md-nav__link">
        Feature importance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user_guides/forecasting-xgboost.html" class="md-nav__link">
        Forecasting with XGBoost
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user_guides/save-load-forecaster.html" class="md-nav__link">
        Save and load forecaster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user_guides/forecaster-in-production.html" class="md-nav__link">
        Forecaster in production
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user_guides/grid-search-sarimax-arima.html" class="md-nav__link">
        Grid search SARIMAX and ARIMA models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user_guides/backtesting-sarimax-arima.html" class="md-nav__link">
        Backtesting SARIMAX and ARIMA models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user_guides/plot-forecaster-residuals.html" class="md-nav__link">
        Plot forecaster residuals
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Examples and tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Examples and tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Examples and tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/examples.html" class="md-nav__link">
        Examples and tutorials
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="ForecasterAutoreg.html" class="md-nav__link">
        ForecasterAutoreg
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="ForecasterAutoregCustom.html" class="md-nav__link">
        ForecasterAutoregCustom
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="ForecasterAutoregDirect.html" class="md-nav__link">
        ForecasterAutoregDirect
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          ForecasterMultiSeries
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="ForecasterMultiSeries.html" class="md-nav__link md-nav__link--active">
        ForecasterMultiSeries
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries" class="md-nav__link">
    skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.create_train_X_y" class="md-nav__link">
    create_train_X_y()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.get_feature_importance" class="md-nav__link">
    get_feature_importance()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.predict" class="md-nav__link">
    predict()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.predict_interval" class="md-nav__link">
    predict_interval()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.set_lags" class="md-nav__link">
    set_lags()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.set_out_sample_residuals" class="md-nav__link">
    set_out_sample_residuals()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.set_params" class="md-nav__link">
    set_params()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="model_selection.html" class="md-nav__link">
        model_selection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="model_selection_multiseries.html" class="md-nav__link">
        model_selection_multiseries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="model_selection_statsmodels.html" class="md-nav__link">
        model_selection_statsmodels
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="plot.html" class="md-nav__link">
        plot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="utils.html" class="md-nav__link">
        utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          FAQ and Tips
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="FAQ and Tips" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          FAQ and Tips
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../faq/non-negative-predictions.html" class="md-nav__link">
        Avoid negative predictions when forecasting
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../releases/releases.html" class="md-nav__link">
        Releases
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries" class="md-nav__link">
    skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.create_train_X_y" class="md-nav__link">
    create_train_X_y()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.get_feature_importance" class="md-nav__link">
    get_feature_importance()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.predict" class="md-nav__link">
    predict()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.predict_interval" class="md-nav__link">
    predict_interval()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.set_lags" class="md-nav__link">
    set_lags()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.set_out_sample_residuals" class="md-nav__link">
    set_out_sample_residuals()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.set_params" class="md-nav__link">
    set_params()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/JoaquinAmatRodrigo/skforecast/edit/master/docs/api/ForecasterMultiSeries.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="forecasterautoregmultiseries"><code>ForecasterAutoregMultiSeries</code><a class="headerlink" href="#forecasterautoregmultiseries" title="Permanent link">&para;</a></h1>


  <div class="doc doc-object doc-class">

<a id="skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries"></a>
    <div class="doc doc-contents first">

      <p>This class turns any regressor compatible with the scikit-learn API into a</p>
<p>recursive autoregressive (multi-step) forecaster for multiple series.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>regressor</code></td>
        <td><code>regressor or pipeline compatible with the scikit-learn API</code></td>
        <td><p>An instance of a regressor or pipeline compatible with the scikit-learn API.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>lags</code></td>
        <td><code>Union[int, numpy.ndarray, list]</code></td>
        <td><p>Lags used as predictors. Index starts at 1, so lag 1 is equal to t-1.
    <code>int</code>: include lags from 1 to <code>lags</code> (included).
    <code>list</code>, <code>numpy ndarray</code> or <code>range</code>: include only lags present in <code>lags</code>,
    all elements must be int.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>transformer_series</code></td>
        <td><code>transformer (preprocessor) compatible with the scikit-learn</code></td>
        <td><p>preprocessing API or <code>dict</code> {level: transformer}, default <code>None</code>
An instance of a transformer (preprocessor) compatible with the scikit-learn
preprocessing API with methods: fit, transform, fit_transform and inverse_transform.
ColumnTransformers are not allowed since they do not have inverse_transform method.
The transformation is applied to each <code>level</code> before training the forecaster.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>transformer_exog</code></td>
        <td><code>transformer (preprocessor) compatible with the scikit-learn</code></td>
        <td><p>preprocessing API, default <code>None</code>
An instance of a transformer (preprocessor) compatible with the scikit-learn
preprocessing API. The transformation is applied to <code>exog</code> before training the
forecaster. <code>inverse_transform</code> is not available when using ColumnTransformers.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>regressor</code></td>
        <td><code>regressor or pipeline compatible with the scikit-learn API</code></td>
        <td><p>An instance of a regressor or pipeline compatible with the scikit-learn API.</p></td>
      </tr>
      <tr>
        <td><code>lags</code></td>
        <td><code>numpy ndarray</code></td>
        <td><p>Lags used as predictors.</p></td>
      </tr>
      <tr>
        <td><code>transformer_series</code></td>
        <td><code>transformer (preprocessor) compatible with the scikit-learn</code></td>
        <td><p>preprocessing API, default <code>None</code>
An instance of a transformer (preprocessor) compatible with the scikit-learn
preprocessing API with methods: fit, transform, fit_transform and inverse_transform.
ColumnTransformers are not allowed since they do not have inverse_transform method.
The transformation is applied to each <code>level</code> before training the forecaster.</p></td>
      </tr>
      <tr>
        <td><code>transformer_exog</code></td>
        <td><code>transformer (preprocessor) compatible with the scikit-learn</code></td>
        <td><p>preprocessing API, default <code>None</code>
An instance of a transformer (preprocessor) compatible with the scikit-learn
preprocessing API. The transformation is applied to <code>exog</code> before training the
forecaster. <code>inverse_transform</code> is not available when using ColumnTransformers.</p></td>
      </tr>
      <tr>
        <td><code>max_lag</code></td>
        <td><code>int</code></td>
        <td><p>Maximum value of lag included in <code>lags</code>.</p></td>
      </tr>
      <tr>
        <td><code>last_window</code></td>
        <td><code>pandas Series</code></td>
        <td><p>Last window the forecaster has seen during trained. It stores the
values needed to predict the next <code>step</code> right after the training data.</p></td>
      </tr>
      <tr>
        <td><code>window_size</code></td>
        <td><code>int</code></td>
        <td><p>Size of the window needed to create the predictors. It is equal to
<code>max_lag</code>.</p></td>
      </tr>
      <tr>
        <td><code>fitted</code></td>
        <td><code>Bool</code></td>
        <td><p>Tag to identify if the regressor has been fitted (trained).</p></td>
      </tr>
      <tr>
        <td><code>index_type</code></td>
        <td><code>type</code></td>
        <td><p>Type of index of the input used in training.</p></td>
      </tr>
      <tr>
        <td><code>index_freq</code></td>
        <td><code>str</code></td>
        <td><p>Frequency of Index of the input used in training.</p></td>
      </tr>
      <tr>
        <td><code>index_values</code></td>
        <td><code>pandas Index</code></td>
        <td><p>Values of Index of the input used in training.</p></td>
      </tr>
      <tr>
        <td><code>training_range</code></td>
        <td><code>pandas Index</code></td>
        <td><p>First and last values of index of the data used during training.</p></td>
      </tr>
      <tr>
        <td><code>included_exog</code></td>
        <td><code>bool</code></td>
        <td><p>If the forecaster has been trained using exogenous variable/s.</p></td>
      </tr>
      <tr>
        <td><code>exog_type</code></td>
        <td><code>type</code></td>
        <td><p>Type of exogenous variable/s used in training.</p></td>
      </tr>
      <tr>
        <td><code>exog_col_names</code></td>
        <td><code>list</code></td>
        <td><p>Names of columns of <code>exog</code> if <code>exog</code> used in training was a pandas
DataFrame.</p></td>
      </tr>
      <tr>
        <td><code>series_levels</code></td>
        <td><code>list</code></td>
        <td><p>Names of the columns (levels) that can be predicted.</p></td>
      </tr>
      <tr>
        <td><code>X_train_col_names</code></td>
        <td><code>list</code></td>
        <td><p>Names of columns of the matrix created internally for training.</p></td>
      </tr>
      <tr>
        <td><code>in_sample_residuals</code></td>
        <td><code>dict</code></td>
        <td><p>Residuals of the model when predicting training data. Only stored up to
1000 values in the form <code>{level: residuals}</code>.</p></td>
      </tr>
      <tr>
        <td><code>out_sample_residuals</code></td>
        <td><code>pandas Series</code></td>
        <td><p>Residuals of the model when predicting non training data. Only stored
up to 1000 values. Use <code>set_out_sample_residuals</code> to set values.</p></td>
      </tr>
      <tr>
        <td><code>creation_date</code></td>
        <td><code>str</code></td>
        <td><p>Date of creation.</p></td>
      </tr>
      <tr>
        <td><code>fit_date</code></td>
        <td><code>str</code></td>
        <td><p>Date of last fit.</p></td>
      </tr>
      <tr>
        <td><code>skforcast_version</code></td>
        <td><code>str</code></td>
        <td><p>Version of skforecast library used to create the forecaster.</p></td>
      </tr>
      <tr>
        <td><code>python_version</code></td>
        <td><code>str</code></td>
        <td><p>Version of python used to create the forecaster.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>skforecast/ForecasterAutoregMultiSeries/ForecasterAutoregMultiSeries.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ForecasterAutoregMultiSeries</span><span class="p">(</span><span class="n">ForecasterBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class turns any regressor compatible with the scikit-learn API into a</span>
<span class="sd">    recursive autoregressive (multi-step) forecaster for multiple series.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    regressor : regressor or pipeline compatible with the scikit-learn API</span>
<span class="sd">        An instance of a regressor or pipeline compatible with the scikit-learn API.</span>

<span class="sd">    lags : int, list, 1d numpy ndarray, range</span>
<span class="sd">        Lags used as predictors. Index starts at 1, so lag 1 is equal to t-1.</span>
<span class="sd">            `int`: include lags from 1 to `lags` (included).</span>
<span class="sd">            `list`, `numpy ndarray` or `range`: include only lags present in `lags`,</span>
<span class="sd">            all elements must be int.</span>

<span class="sd">    transformer_series : transformer (preprocessor) compatible with the scikit-learn</span>
<span class="sd">                         preprocessing API or `dict` {level: transformer}, default `None`</span>
<span class="sd">        An instance of a transformer (preprocessor) compatible with the scikit-learn</span>
<span class="sd">        preprocessing API with methods: fit, transform, fit_transform and inverse_transform.</span>
<span class="sd">        ColumnTransformers are not allowed since they do not have inverse_transform method.</span>
<span class="sd">        The transformation is applied to each `level` before training the forecaster.</span>

<span class="sd">    transformer_exog : transformer (preprocessor) compatible with the scikit-learn</span>
<span class="sd">                       preprocessing API, default `None`</span>
<span class="sd">        An instance of a transformer (preprocessor) compatible with the scikit-learn</span>
<span class="sd">        preprocessing API. The transformation is applied to `exog` before training the</span>
<span class="sd">        forecaster. `inverse_transform` is not available when using ColumnTransformers.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    regressor : regressor or pipeline compatible with the scikit-learn API</span>
<span class="sd">        An instance of a regressor or pipeline compatible with the scikit-learn API.</span>

<span class="sd">    lags : numpy ndarray</span>
<span class="sd">        Lags used as predictors.</span>

<span class="sd">    transformer_series : transformer (preprocessor) compatible with the scikit-learn</span>
<span class="sd">                         preprocessing API, default `None`</span>
<span class="sd">        An instance of a transformer (preprocessor) compatible with the scikit-learn</span>
<span class="sd">        preprocessing API with methods: fit, transform, fit_transform and inverse_transform.</span>
<span class="sd">        ColumnTransformers are not allowed since they do not have inverse_transform method.</span>
<span class="sd">        The transformation is applied to each `level` before training the forecaster.</span>

<span class="sd">    transformer_exog : transformer (preprocessor) compatible with the scikit-learn</span>
<span class="sd">                       preprocessing API, default `None`</span>
<span class="sd">        An instance of a transformer (preprocessor) compatible with the scikit-learn</span>
<span class="sd">        preprocessing API. The transformation is applied to `exog` before training the</span>
<span class="sd">        forecaster. `inverse_transform` is not available when using ColumnTransformers.</span>

<span class="sd">    max_lag : int</span>
<span class="sd">        Maximum value of lag included in `lags`.</span>

<span class="sd">    last_window : pandas Series</span>
<span class="sd">        Last window the forecaster has seen during trained. It stores the</span>
<span class="sd">        values needed to predict the next `step` right after the training data.</span>

<span class="sd">    window_size: int</span>
<span class="sd">        Size of the window needed to create the predictors. It is equal to</span>
<span class="sd">        `max_lag`.</span>

<span class="sd">    fitted: Bool</span>
<span class="sd">        Tag to identify if the regressor has been fitted (trained).</span>

<span class="sd">    index_type : type</span>
<span class="sd">        Type of index of the input used in training.</span>

<span class="sd">    index_freq : str</span>
<span class="sd">        Frequency of Index of the input used in training.</span>

<span class="sd">    index_values : pandas Index</span>
<span class="sd">        Values of Index of the input used in training.</span>

<span class="sd">    training_range: pandas Index</span>
<span class="sd">        First and last values of index of the data used during training.</span>

<span class="sd">    included_exog : bool</span>
<span class="sd">        If the forecaster has been trained using exogenous variable/s.</span>

<span class="sd">    exog_type : type</span>
<span class="sd">        Type of exogenous variable/s used in training.</span>

<span class="sd">    exog_col_names : list</span>
<span class="sd">        Names of columns of `exog` if `exog` used in training was a pandas</span>
<span class="sd">        DataFrame.</span>

<span class="sd">    series_levels : list</span>
<span class="sd">        Names of the columns (levels) that can be predicted.</span>

<span class="sd">    X_train_col_names : list</span>
<span class="sd">        Names of columns of the matrix created internally for training.</span>

<span class="sd">    in_sample_residuals: dict</span>
<span class="sd">        Residuals of the model when predicting training data. Only stored up to</span>
<span class="sd">        1000 values in the form `{level: residuals}`.</span>

<span class="sd">    out_sample_residuals: pandas Series</span>
<span class="sd">        Residuals of the model when predicting non training data. Only stored</span>
<span class="sd">        up to 1000 values. Use `set_out_sample_residuals` to set values.</span>

<span class="sd">    creation_date: str</span>
<span class="sd">        Date of creation.</span>

<span class="sd">    fit_date: str</span>
<span class="sd">        Date of last fit.</span>

<span class="sd">    skforcast_version: str</span>
<span class="sd">        Version of skforecast library used to create the forecaster.</span>

<span class="sd">    python_version: str</span>
<span class="sd">        Version of python used to create the forecaster.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">regressor</span><span class="p">,</span>
        <span class="n">lags</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
        <span class="n">transformer_series</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">transformer_exog</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">regressor</span>            <span class="o">=</span> <span class="n">regressor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span>   <span class="o">=</span> <span class="n">transformer_series</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transformer_exog</span>     <span class="o">=</span> <span class="n">transformer_exog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_type</span>           <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_freq</span>           <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_values</span>         <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">training_range</span>       <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_window</span>          <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">included_exog</span>        <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exog_type</span>            <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exog_col_names</span>       <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">series_levels</span>        <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_train_col_names</span>    <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_sample_residuals</span>  <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out_sample_residuals</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitted</span>               <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creation_date</span>        <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_date</span>             <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skforcast_version</span>    <span class="o">=</span> <span class="n">skforecast</span><span class="o">.</span><span class="n">__version__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">python_version</span>       <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">lags</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Minimum value of lags allowed is 1.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">range</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">min</span><span class="p">(</span><span class="n">lags</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Minimum value of lags allowed is 1.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="n">lags</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lag</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Values in lags must be int.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lags</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">range</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lags</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lags</span> <span class="o">=</span> <span class="n">lags</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;`lags` argument must be int, 1d numpy ndarray, range or list. &#39;</span>
                <span class="sa">f</span><span class="s2">&quot;Got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">lags</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_lag</span>  <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_lag</span>


    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span>
        <span class="bp">self</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Information displayed when a ForecasterAutoregMultiSeries object is printed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="p">,</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">):</span>
            <span class="n">name_pipe_steps</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;__&quot;</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="o">.</span><span class="n">named_steps</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span> <span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> \
                     <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">name_pipe_steps</span><span class="p">)}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>

        <span class="n">info</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Regressor: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Lags: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lags</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Transformer for series: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Transformer for exog: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">transformer_exog</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Window size: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Series levels: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">series_levels</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Included exogenous: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">included_exog</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Type of exogenous variable: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">exog_type</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Exogenous variables names: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">exog_col_names</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Training range: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">training_range</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitted</span> <span class="k">else</span> <span class="kc">None</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Training index type: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_type</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitted</span> <span class="k">else</span> <span class="kc">None</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Training index frequency: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">index_freq</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitted</span> <span class="k">else</span> <span class="kc">None</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Regressor parameters: </span><span class="si">{</span><span class="n">params</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Creation date: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">creation_date</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Last fit date: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_date</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Skforecast version: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">skforcast_version</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Python version: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">python_version</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">info</span>


    <span class="k">def</span> <span class="nf">_create_lags</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> 
        <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;       </span>
<span class="sd">        Transforms a 1d array into a 2d array (X) and a 1d array (y). Each row</span>
<span class="sd">        in X is associated with a value of y and it represents the lags that</span>
<span class="sd">        precede it.</span>

<span class="sd">        Notice that, the returned matrix X_data, contains the lag 1 in the first</span>
<span class="sd">        column, the lag 2 in the second column and so on.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------        </span>
<span class="sd">        y : 1d numpy ndarray</span>
<span class="sd">            Training time series.</span>

<span class="sd">        Returns </span>
<span class="sd">        -------</span>
<span class="sd">        X_data : 2d numpy ndarray, shape (samples - max(self.lags), len(self.lags))</span>
<span class="sd">            2d numpy array with the lagged values (predictors).</span>

<span class="sd">        y_data : 1d numpy ndarray, shape (samples - max(self.lags),)</span>
<span class="sd">            Values of the time series related to each row of `X_data`.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">n_splits</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_lag</span>
        <span class="k">if</span> <span class="n">n_splits</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;The maximum lag (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_lag</span><span class="si">}</span><span class="s1">) must be less than the length &#39;</span>
                <span class="sa">f</span><span class="s1">&#39;of the series (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="si">}</span><span class="s1">).&#39;</span>
            <span class="p">)</span>

        <span class="n">X_data</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_splits</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_lag</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">y_data</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_splits</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_splits</span><span class="p">):</span>
            <span class="n">X_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_lag</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">y_index</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">max_lag</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
            <span class="n">X_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">X_index</span><span class="p">]</span>
            <span class="n">y_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>    <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">y_index</span><span class="p">]</span>

        <span class="n">X_data</span> <span class="o">=</span> <span class="n">X_data</span><span class="p">[:,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lags</span><span class="p">]</span> <span class="c1"># Only keep needed lags</span>
        <span class="n">y_data</span> <span class="o">=</span> <span class="n">y_data</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">X_data</span><span class="p">,</span> <span class="n">y_data</span>


    <span class="k">def</span> <span class="nf">create_train_X_y</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">exog</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create training matrices from univariate time series and exogenous</span>
<span class="sd">        variables.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------        </span>
<span class="sd">        series : pandas DataFrame</span>
<span class="sd">            Training time series.</span>

<span class="sd">        exog : pandas Series, pandas DataFrame, default `None`</span>
<span class="sd">            Exogenous variable/s included as predictor/s. Must have the same</span>
<span class="sd">            number of observations as `y` and their indexes must be aligned.</span>

<span class="sd">        Returns </span>
<span class="sd">        -------</span>
<span class="sd">        X_train : pandas DataFrame</span>
<span class="sd">            Pandas DataFrame with the training values (predictors).</span>

<span class="sd">        y_train : pandas Series, shape (len(y) - self.max_lag, )</span>
<span class="sd">            Values (target) of the time series related to each row of `X_train`.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;`series` must be a pandas DataFrame.&#39;</span><span class="p">)</span>

        <span class="n">X_levels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">X_train_col_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;lag_</span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lags</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">serie</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>

            <span class="n">y</span> <span class="o">=</span> <span class="n">series</span><span class="p">[</span><span class="n">serie</span><span class="p">]</span>
            <span class="n">check_y</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">transform_series</span><span class="p">(</span>
                    <span class="n">series</span>            <span class="o">=</span> <span class="n">y</span><span class="p">,</span>
                    <span class="n">transformer</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="p">[</span><span class="n">serie</span><span class="p">],</span>
                    <span class="n">fit</span>               <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="n">inverse_transform</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="p">)</span>
            <span class="n">y_values</span><span class="p">,</span> <span class="n">y_index</span> <span class="o">=</span> <span class="n">preprocess_y</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
            <span class="n">X_train_values</span><span class="p">,</span> <span class="n">y_train_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_lags</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y_values</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train_values</span>
                <span class="n">y_train</span> <span class="o">=</span> <span class="n">y_train_values</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_train_values</span><span class="p">))</span>
                <span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_train_values</span><span class="p">)</span>

            <span class="n">X_level</span> <span class="o">=</span> <span class="p">[</span><span class="n">serie</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train_values</span><span class="p">)</span>
            <span class="n">X_levels</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">X_level</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">exog</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">series</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;`exog` must have same number of samples as `series`. &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;length `exog`: (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">exog</span><span class="p">)</span><span class="si">}</span><span class="s1">), length `series`: (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">series</span><span class="p">)</span><span class="si">}</span><span class="s1">)&#39;</span>
                <span class="p">)</span>
            <span class="n">check_exog</span><span class="p">(</span><span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exog</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
                <span class="n">exog</span> <span class="o">=</span> <span class="n">transform_series</span><span class="p">(</span>
                            <span class="n">series</span>            <span class="o">=</span> <span class="n">exog</span><span class="p">,</span>
                            <span class="n">transformer</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_exog</span><span class="p">,</span>
                            <span class="n">fit</span>               <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="n">inverse_transform</span> <span class="o">=</span> <span class="kc">False</span>
                       <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">exog</span> <span class="o">=</span> <span class="n">transform_dataframe</span><span class="p">(</span>
                            <span class="n">df</span>                <span class="o">=</span> <span class="n">exog</span><span class="p">,</span>
                            <span class="n">transformer</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_exog</span><span class="p">,</span>
                            <span class="n">fit</span>               <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="n">inverse_transform</span> <span class="o">=</span> <span class="kc">False</span>
                       <span class="p">)</span>
            <span class="n">exog_values</span><span class="p">,</span> <span class="n">exog_index</span> <span class="o">=</span> <span class="n">preprocess_exog</span><span class="p">(</span><span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">exog_index</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">y_index</span><span class="p">)]</span> <span class="o">==</span> <span class="n">y_index</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="p">(</span><span class="s1">&#39;Different index for `series` and `exog`. They must be equal &#39;</span>
                     <span class="s1">&#39;to ensure the correct alignment of values.&#39;</span><span class="p">)</span>      
                <span class="p">)</span>
            <span class="n">col_names_exog</span> <span class="o">=</span> <span class="n">exog</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exog</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">exog</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="n">X_train_col_names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">col_names_exog</span><span class="p">)</span>

            <span class="c1"># The first `self.max_lag` positions have to be removed from exog</span>
            <span class="c1"># since they are not in X_train. Then exog is cloned as many times</span>
            <span class="c1"># as series.</span>
            <span class="k">if</span> <span class="n">exog_values</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span>
                            <span class="n">X_train</span><span class="p">,</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">exog_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">max_lag</span><span class="p">:,</span> <span class="p">],</span> <span class="n">series</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                          <span class="p">))</span> 

            <span class="k">else</span><span class="p">:</span>
                <span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span>
                            <span class="n">X_train</span><span class="p">,</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">exog_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">max_lag</span><span class="p">:,</span> <span class="p">],</span> <span class="p">[</span><span class="n">series</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span>
                          <span class="p">))</span>

        <span class="n">X_levels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">X_levels</span><span class="p">)</span>
        <span class="n">X_levels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">X_levels</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">X_train_col_names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">X_levels</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_levels</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>

        <span class="n">X_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="n">data</span>    <span class="o">=</span> <span class="n">X_train</span><span class="p">,</span>
                    <span class="n">columns</span> <span class="o">=</span> <span class="n">X_train_col_names</span>
                <span class="p">)</span>

        <span class="n">y_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                    <span class="n">data</span>  <span class="o">=</span> <span class="n">y_train</span><span class="p">,</span>
                    <span class="n">name</span>  <span class="o">=</span> <span class="s1">&#39;y&#39;</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">X_train_col_names</span> <span class="o">=</span> <span class="n">X_train_col_names</span>

        <span class="k">return</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_index</span>


    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">exog</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">store_in_sample_residuals</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Training Forecaster.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------        </span>
<span class="sd">        series : pandas DataFrame</span>
<span class="sd">            Training time series.</span>

<span class="sd">        exog : pandas Series, pandas DataFrame, default `None`</span>
<span class="sd">            Exogenous variable/s included as predictor/s. Must have the same</span>
<span class="sd">            number of observations as `y` and their indexes must be aligned so</span>
<span class="sd">            that y[i] is regressed on exog[i].</span>

<span class="sd">        store_in_sample_residuals : bool, default `True`</span>
<span class="sd">            if True, in_sample_residuals are stored.</span>

<span class="sd">        Returns </span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Reset values in case the forecaster has already been fitted.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_type</span>           <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_freq</span>           <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_values</span>         <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_window</span>          <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">included_exog</span>        <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exog_type</span>            <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exog_col_names</span>       <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">series_levels</span>        <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_train_col_names</span>    <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_sample_residuals</span>  <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitted</span>               <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">training_range</span>       <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">series_levels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dict_transformers</span> <span class="o">=</span> <span class="p">{</span><span class="n">level</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_levels</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span> <span class="o">=</span> <span class="n">dict_transformers</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">dict_transformers</span> <span class="o">=</span> <span class="p">{</span><span class="n">level</span><span class="p">:</span> <span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="p">)</span> 
                                 <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_levels</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span> <span class="o">=</span> <span class="n">dict_transformers</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_levels</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;When `transformer_series` parameter is a `dict`, its keys &#39;</span>
                     <span class="sa">f</span><span class="s1">&#39;must be the same as `series_levels` : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">series_levels</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">included_exog</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exog_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">exog</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exog_col_names</span> <span class="o">=</span> \
                 <span class="n">exog</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exog</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="k">else</span> <span class="n">exog</span><span class="o">.</span><span class="n">name</span>

        <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_train_X_y</span><span class="p">(</span><span class="n">series</span><span class="o">=</span><span class="n">series</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="p">))</span> <span class="o">==</span> <span class="s2">&quot;&lt;class &#39;xgboost.sklearn.XGBRegressor&#39;&gt;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fitted</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">training_range</span> <span class="o">=</span> <span class="n">y_index</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">y_index</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y_index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">index_freq</span> <span class="o">=</span> <span class="n">y_index</span><span class="o">.</span><span class="n">freqstr</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">index_freq</span> <span class="o">=</span> <span class="n">y_index</span><span class="o">.</span><span class="n">step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_values</span> <span class="o">=</span> <span class="n">y_index</span>

        <span class="n">residuals_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># This is done to save time during fit in functions such as backtesting()</span>
        <span class="k">if</span> <span class="n">store_in_sample_residuals</span><span class="p">:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="p">))</span> <span class="o">==</span> <span class="s2">&quot;&lt;class &#39;xgboost.sklearn.XGBRegressor&#39;&gt;&quot;</span><span class="p">:</span>
                <span class="n">residuals</span> <span class="o">=</span> <span class="n">y_train</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">residuals</span> <span class="o">=</span> <span class="n">y_train</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>

            <span class="k">for</span> <span class="n">serie</span> <span class="ow">in</span> <span class="n">series</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">residuals_dict</span><span class="p">[</span><span class="n">serie</span><span class="p">]</span> <span class="o">=</span> <span class="n">residuals</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">X_train</span><span class="p">[</span><span class="n">serie</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuals_dict</span><span class="p">[</span><span class="n">serie</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                    <span class="c1"># Only up to 1000 residuals are stored</span>
                    <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
                    <span class="n">residuals_dict</span><span class="p">[</span><span class="n">serie</span><span class="p">]</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
                                                <span class="n">a</span>       <span class="o">=</span> <span class="n">residuals_dict</span><span class="p">[</span><span class="n">serie</span><span class="p">],</span> 
                                                <span class="n">size</span>    <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> 
                                                <span class="n">replace</span> <span class="o">=</span> <span class="kc">False</span>
                                            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">serie</span> <span class="ow">in</span> <span class="n">series</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">residuals_dict</span><span class="p">[</span><span class="n">serie</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">None</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">in_sample_residuals</span> <span class="o">=</span> <span class="n">residuals_dict</span>

        <span class="c1"># The last time window of training data is stored so that lags needed as</span>
        <span class="c1"># predictors in the first iteration of `predict()` can be calculated.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_window</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">max_lag</span><span class="p">:,</span> <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">_recursive_predict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">steps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">level</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">last_window</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">exog</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Predict n steps ahead. It is an iterative process in which, each prediction,</span>
<span class="sd">        is used as a predictor for the next step.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        steps : int</span>
<span class="sd">            Number of future steps predicted.</span>

<span class="sd">        level : str</span>
<span class="sd">            Time series to be predicted.</span>

<span class="sd">        last_window : numpy ndarray</span>
<span class="sd">            Values of the series used to create the predictors (lags) need in the </span>
<span class="sd">            first iteration of prediction (t + 1).</span>

<span class="sd">        exog : numpy ndarray, pandas DataFrame</span>
<span class="sd">            Exogenous variable/s included as predictor/s.</span>

<span class="sd">        Returns </span>
<span class="sd">        -------</span>
<span class="sd">        predictions : numpy ndarray</span>
<span class="sd">            Predicted values.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">steps</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">last_window</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lags</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">X</span><span class="p">,</span> <span class="n">exog</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)))</span>

            <span class="n">levels_dummies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_levels</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">levels_dummies</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">series_levels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">level</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.</span>

            <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">X</span><span class="p">,</span> <span class="n">levels_dummies</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)))</span>

            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="c1"># Suppress scikitlearn warning: &quot;X does not have valid feature names,</span>
                <span class="c1"># but NoOpTransformer was fitted with feature names&quot;.</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
                <span class="n">prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
                <span class="n">predictions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">prediction</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Update `last_window` values. The first position is discarded and </span>
            <span class="c1"># the new prediction is added at the end.</span>
            <span class="n">last_window</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last_window</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">prediction</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">predictions</span>


    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">steps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">level</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">last_window</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">exog</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Predict n steps ahead. It is an recursive process in which, each prediction,</span>
<span class="sd">        is used as a predictor for the next step.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        steps : int</span>
<span class="sd">            Number of future steps predicted.</span>

<span class="sd">        level : str</span>
<span class="sd">            Time series to be predicted.</span>

<span class="sd">        last_window : pandas DataFrame, default `None`</span>
<span class="sd">            Values of the series used to create the predictors (lags) need in the </span>
<span class="sd">            first iteration of prediction (t + 1).</span>

<span class="sd">            If `last_window = None`, the values stored in `self.last_window` are</span>
<span class="sd">            used to calculate the initial predictors, and the predictions start</span>
<span class="sd">            right after training data.</span>

<span class="sd">        exog : pandas Series, pandas DataFrame, default `None`</span>
<span class="sd">            Exogenous variable/s included as predictor/s.</span>

<span class="sd">        Returns </span>
<span class="sd">        -------</span>
<span class="sd">        predictions : pandas Series</span>
<span class="sd">            Predicted values.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">check_predict_input</span><span class="p">(</span>
            <span class="n">forecaster_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
            <span class="n">steps</span>           <span class="o">=</span> <span class="n">steps</span><span class="p">,</span>
            <span class="n">fitted</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitted</span><span class="p">,</span>
            <span class="n">included_exog</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">included_exog</span><span class="p">,</span>
            <span class="n">index_type</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_type</span><span class="p">,</span>
            <span class="n">index_freq</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_freq</span><span class="p">,</span>
            <span class="n">window_size</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">,</span>
            <span class="n">last_window</span>     <span class="o">=</span> <span class="n">last_window</span><span class="p">,</span>
            <span class="n">exog</span>            <span class="o">=</span> <span class="n">exog</span><span class="p">,</span>
            <span class="n">exog_type</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog_type</span><span class="p">,</span>
            <span class="n">exog_col_names</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog_col_names</span><span class="p">,</span>
            <span class="n">interval</span>        <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">max_steps</span>       <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">level</span>           <span class="o">=</span> <span class="n">level</span><span class="p">,</span>
            <span class="n">series_levels</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_levels</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exog</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
                <span class="n">exog</span> <span class="o">=</span> <span class="n">transform_dataframe</span><span class="p">(</span>
                            <span class="n">df</span>                <span class="o">=</span> <span class="n">exog</span><span class="p">,</span>
                            <span class="n">transformer</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_exog</span><span class="p">,</span>
                            <span class="n">fit</span>               <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">inverse_transform</span> <span class="o">=</span> <span class="kc">False</span>
                       <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">exog</span> <span class="o">=</span> <span class="n">transform_series</span><span class="p">(</span>
                            <span class="n">series</span>            <span class="o">=</span> <span class="n">exog</span><span class="p">,</span>
                            <span class="n">transformer</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_exog</span><span class="p">,</span>
                            <span class="n">fit</span>               <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">inverse_transform</span> <span class="o">=</span> <span class="kc">False</span>
                       <span class="p">)</span>

            <span class="n">exog_values</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">preprocess_exog</span><span class="p">(</span>
                                <span class="n">exog</span> <span class="o">=</span> <span class="n">exog</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">steps</span><span class="p">,</span> <span class="p">]</span>
                             <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exog_values</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">last_window</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">last_window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_window</span><span class="p">[</span><span class="n">level</span><span class="p">]</span>

        <span class="n">last_window</span> <span class="o">=</span> <span class="n">transform_series</span><span class="p">(</span>
                            <span class="n">series</span>            <span class="o">=</span> <span class="n">last_window</span><span class="p">,</span>
                            <span class="n">transformer</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="p">[</span><span class="n">level</span><span class="p">],</span>
                            <span class="n">fit</span>               <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">inverse_transform</span> <span class="o">=</span> <span class="kc">False</span>
                      <span class="p">)</span>
        <span class="n">last_window_values</span><span class="p">,</span> <span class="n">last_window_index</span> <span class="o">=</span> <span class="n">preprocess_last_window</span><span class="p">(</span>
                                                    <span class="n">last_window</span> <span class="o">=</span> <span class="n">last_window</span>
                                                <span class="p">)</span>

        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recursive_predict</span><span class="p">(</span>
                        <span class="n">steps</span>       <span class="o">=</span> <span class="n">steps</span><span class="p">,</span>
                        <span class="n">level</span>       <span class="o">=</span> <span class="n">level</span><span class="p">,</span>
                        <span class="n">last_window</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">last_window_values</span><span class="p">),</span>
                        <span class="n">exog</span>        <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">exog_values</span><span class="p">)</span>
                      <span class="p">)</span>

        <span class="n">predictions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                        <span class="n">data</span>  <span class="o">=</span> <span class="n">predictions</span><span class="p">,</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="n">expand_index</span><span class="p">(</span>
                                    <span class="n">index</span> <span class="o">=</span> <span class="n">last_window_index</span><span class="p">,</span>
                                    <span class="n">steps</span> <span class="o">=</span> <span class="n">steps</span>
                                <span class="p">),</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;pred&#39;</span>
                      <span class="p">)</span>

        <span class="n">predictions</span> <span class="o">=</span> <span class="n">transform_series</span><span class="p">(</span>
                        <span class="n">series</span>            <span class="o">=</span> <span class="n">predictions</span><span class="p">,</span>
                        <span class="n">transformer</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="p">[</span><span class="n">level</span><span class="p">],</span>
                        <span class="n">fit</span>               <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">inverse_transform</span> <span class="o">=</span> <span class="kc">True</span>
                      <span class="p">)</span>

        <span class="k">return</span> <span class="n">predictions</span>


    <span class="k">def</span> <span class="nf">_estimate_boot_interval</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">steps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">level</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">last_window</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">exog</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">interval</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">95</span><span class="p">],</span>
        <span class="n">n_boot</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span>
        <span class="n">in_sample_residuals</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterative process in which, each prediction, is used as a predictor</span>
<span class="sd">        for the next step and bootstrapping is used to estimate prediction</span>
<span class="sd">        intervals. This method only returns prediction intervals.</span>
<span class="sd">        See predict_intervals() to calculate both, predictions and intervals.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------   </span>
<span class="sd">        steps : int</span>
<span class="sd">            Number of future steps predicted.</span>

<span class="sd">        level : str</span>
<span class="sd">            Time series to be predicted.</span>

<span class="sd">        last_window : 1d numpy ndarray shape (, max_lag), default `None`</span>
<span class="sd">            Values of the series used to create the predictors (lags) needed in the </span>
<span class="sd">            first iteration of prediction (t + 1).</span>

<span class="sd">            If `last_window = `None`, the values stored in` self.last_window` are</span>
<span class="sd">            used to calculate the initial predictors, and the predictions start</span>
<span class="sd">            right after training data.</span>

<span class="sd">        exog : numpy ndarray, default `None`</span>
<span class="sd">            Exogenous variable/s included as predictor/s.</span>

<span class="sd">        n_boot : int, default `500`</span>
<span class="sd">            Number of bootstrapping iterations used to estimate prediction</span>
<span class="sd">            intervals.</span>

<span class="sd">        random_state : int</span>
<span class="sd">            Sets a seed to the random generator, so that boot intervals are always </span>
<span class="sd">            deterministic.</span>

<span class="sd">        interval : list, default `[5, 95]`</span>
<span class="sd">            Confidence of the prediction interval estimated. Sequence of </span>
<span class="sd">            percentiles to compute, which must be between 0 and 100 inclusive. </span>
<span class="sd">            For example, interval of 95% should be as `interval = [2.5, 97.5]`.</span>

<span class="sd">        in_sample_residuals : bool, default `True`</span>
<span class="sd">            If `True`, residuals from the training data are used as proxy of</span>
<span class="sd">            prediction error to create prediction intervals. If `False`, out of</span>
<span class="sd">            sample residuals are used. In the latter case, the user should have</span>
<span class="sd">            calculated and stored the residuals within the forecaster (see</span>
<span class="sd">            `set_out_sample_residuals()`).</span>

<span class="sd">        Returns </span>
<span class="sd">        -------</span>
<span class="sd">        prediction_interval : numpy ndarray, shape (steps, 2)</span>
<span class="sd">            Interval estimated for each prediction by bootstrapping:</span>
<span class="sd">                first column = lower bound of the interval.</span>
<span class="sd">                second column= upper bound interval of the interval.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        More information about prediction intervals in forecasting:</span>
<span class="sd">        https://otexts.com/fpp2/prediction-intervals.html</span>
<span class="sd">        Forecasting: Principles and Practice (2nd ed) Rob J Hyndman and</span>
<span class="sd">        George Athanasopoulos.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">last_window</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">last_window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_window</span><span class="p">[</span><span class="n">level</span><span class="p">]</span>
            <span class="n">last_window</span> <span class="o">=</span> <span class="n">last_window</span><span class="o">.</span><span class="n">values</span>

        <span class="n">boot_predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
                                <span class="n">shape</span>      <span class="o">=</span> <span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">n_boot</span><span class="p">),</span>
                                <span class="n">fill_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                                <span class="n">dtype</span>      <span class="o">=</span> <span class="nb">float</span>
                           <span class="p">)</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="n">seeds</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_boot</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_boot</span><span class="p">):</span>
            <span class="c1"># In each bootstraping iteration the initial last_window and exog </span>
            <span class="c1"># need to be restored.</span>
            <span class="n">last_window_boot</span> <span class="o">=</span> <span class="n">last_window</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">exog_boot</span> <span class="o">=</span> <span class="n">exog</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">exog_boot</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">in_sample_residuals</span><span class="p">:</span>
                <span class="n">residuals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_sample_residuals</span><span class="p">[</span><span class="n">level</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">residuals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_sample_residuals</span>

            <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seeds</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">sample_residuals</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
                                    <span class="n">a</span>       <span class="o">=</span> <span class="n">residuals</span><span class="p">,</span>
                                    <span class="n">size</span>    <span class="o">=</span> <span class="n">steps</span><span class="p">,</span>
                                    <span class="n">replace</span> <span class="o">=</span> <span class="kc">True</span>
                               <span class="p">)</span>

            <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
                <span class="n">prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recursive_predict</span><span class="p">(</span>
                                <span class="n">steps</span>       <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                                <span class="n">level</span>       <span class="o">=</span> <span class="n">level</span><span class="p">,</span>
                                <span class="n">last_window</span> <span class="o">=</span> <span class="n">last_window_boot</span><span class="p">,</span>
                                <span class="n">exog</span>        <span class="o">=</span> <span class="n">exog_boot</span> 
                             <span class="p">)</span>

                <span class="n">prediction_with_residual</span>  <span class="o">=</span> <span class="n">prediction</span> <span class="o">+</span> <span class="n">sample_residuals</span><span class="p">[</span><span class="n">step</span><span class="p">]</span>
                <span class="n">boot_predictions</span><span class="p">[</span><span class="n">step</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">prediction_with_residual</span>

                <span class="n">last_window_boot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                       <span class="n">last_window_boot</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                                       <span class="n">prediction_with_residual</span>
                                   <span class="p">)</span>

                <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">exog_boot</span> <span class="o">=</span> <span class="n">exog_boot</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="n">prediction_interval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">boot_predictions</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">interval</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">prediction_interval</span> <span class="o">=</span> <span class="n">prediction_interval</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">prediction_interval</span>


    <span class="k">def</span> <span class="nf">predict_interval</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">steps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">level</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">last_window</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">exog</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">interval</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">95</span><span class="p">],</span>
        <span class="n">n_boot</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span>
        <span class="n">in_sample_residuals</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterative process in which, each prediction, is used as a predictor</span>
<span class="sd">        for the next step and bootstrapping is used to estimate prediction</span>
<span class="sd">        intervals. Both, predictions and intervals, are returned.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------- </span>
<span class="sd">        steps : int</span>
<span class="sd">            Number of future steps predicted.</span>

<span class="sd">        level : str</span>
<span class="sd">            Time series to be predicted.        </span>

<span class="sd">        last_window : pandas DataFrame, default `None`</span>
<span class="sd">            Values of the series used to create the predictors (lags) needed in the </span>
<span class="sd">            first iteration of prediction (t + 1).</span>

<span class="sd">            If `last_window = None`, the values stored in` self.last_window` are</span>
<span class="sd">            used to calculate the initial predictors, and the predictions start</span>
<span class="sd">            right after training data.</span>

<span class="sd">        exog : pandas Series, pandas DataFrame, default `None`</span>
<span class="sd">            Exogenous variable/s included as predictor/s.</span>

<span class="sd">        interval : list, default `[5, 95]`</span>
<span class="sd">            Confidence of the prediction interval estimated. Sequence of </span>
<span class="sd">            percentiles to compute, which must be between 0 and 100 inclusive. </span>
<span class="sd">            For example, interval of 95% should be as `interval = [2.5, 97.5]`.</span>

<span class="sd">        n_boot : int, default `500`</span>
<span class="sd">            Number of bootstrapping iterations used to estimate prediction</span>
<span class="sd">            intervals.</span>

<span class="sd">        random_state : int, default 123</span>
<span class="sd">            Sets a seed to the random generator, so that boot intervals are always </span>
<span class="sd">            deterministic.</span>

<span class="sd">        in_sample_residuals : bool, default `True`</span>
<span class="sd">            If `True`, residuals from the training data are used as proxy of</span>
<span class="sd">            prediction error to create prediction intervals. If `False`, out of</span>
<span class="sd">            sample residuals are used. In the latter case, the user should have</span>
<span class="sd">            calculated and stored the residuals within the forecaster (see</span>
<span class="sd">            `set_out_sample_residuals()`).</span>

<span class="sd">        Returns </span>
<span class="sd">        -------</span>
<span class="sd">        predictions : pandas DataFrame</span>
<span class="sd">            Values predicted by the forecaster and their estimated interval:</span>
<span class="sd">                column pred = predictions.</span>
<span class="sd">                column lower_bound = lower bound of the interval.</span>
<span class="sd">                column upper_bound = upper bound interval of the interval.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        More information about prediction intervals in forecasting:</span>
<span class="sd">        https://otexts.com/fpp2/prediction-intervals.html</span>
<span class="sd">        Forecasting: Principles and Practice (2nd ed) Rob J Hyndman and</span>
<span class="sd">        George Athanasopoulos.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">in_sample_residuals</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_sample_residuals</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="p">(</span><span class="s1">&#39;`forecaster.in_sample_residuals[level]` contains `None` values. &#39;</span>
                 <span class="s1">&#39;Try using `fit` method with `in_sample_residuals=True` or set in &#39;</span>
                 <span class="s1">&#39;`predict_interval` method `in_sample_residuals=False` and use &#39;</span>
                 <span class="s1">&#39;`out_sample_residuals` (see `set_out_sample_residuals()`).&#39;</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">check_predict_input</span><span class="p">(</span>
            <span class="n">forecaster_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
            <span class="n">steps</span>           <span class="o">=</span> <span class="n">steps</span><span class="p">,</span>
            <span class="n">fitted</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitted</span><span class="p">,</span>
            <span class="n">included_exog</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">included_exog</span><span class="p">,</span>
            <span class="n">index_type</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_type</span><span class="p">,</span>
            <span class="n">index_freq</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_freq</span><span class="p">,</span>
            <span class="n">window_size</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">,</span>
            <span class="n">last_window</span>     <span class="o">=</span> <span class="n">last_window</span><span class="p">,</span>
            <span class="n">exog</span>            <span class="o">=</span> <span class="n">exog</span><span class="p">,</span>
            <span class="n">exog_type</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog_type</span><span class="p">,</span>
            <span class="n">exog_col_names</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog_col_names</span><span class="p">,</span>
            <span class="n">interval</span>        <span class="o">=</span> <span class="n">interval</span><span class="p">,</span>
            <span class="n">max_steps</span>       <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">level</span>           <span class="o">=</span> <span class="n">level</span><span class="p">,</span>
            <span class="n">series_levels</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_levels</span>
        <span class="p">)</span> 

        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exog</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
                <span class="n">exog</span> <span class="o">=</span> <span class="n">transform_dataframe</span><span class="p">(</span>
                            <span class="n">df</span>                <span class="o">=</span> <span class="n">exog</span><span class="p">,</span>
                            <span class="n">transformer</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_exog</span><span class="p">,</span>
                            <span class="n">fit</span>               <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">inverse_transform</span> <span class="o">=</span> <span class="kc">False</span>
                       <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">exog</span> <span class="o">=</span> <span class="n">transform_series</span><span class="p">(</span>
                            <span class="n">series</span>            <span class="o">=</span> <span class="n">exog</span><span class="p">,</span>
                            <span class="n">transformer</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_exog</span><span class="p">,</span>
                            <span class="n">fit</span>               <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">inverse_transform</span> <span class="o">=</span> <span class="kc">False</span>
                       <span class="p">)</span>

            <span class="n">exog_values</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">preprocess_exog</span><span class="p">(</span>
                                <span class="n">exog</span> <span class="o">=</span> <span class="n">exog</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">steps</span><span class="p">,</span> <span class="p">]</span>
                                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exog_values</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">last_window</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">last_window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_window</span><span class="p">[</span><span class="n">level</span><span class="p">]</span>

        <span class="n">last_window</span> <span class="o">=</span> <span class="n">transform_series</span><span class="p">(</span>
                            <span class="n">series</span>            <span class="o">=</span> <span class="n">last_window</span><span class="p">,</span>
                            <span class="n">transformer</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="p">[</span><span class="n">level</span><span class="p">],</span>
                            <span class="n">fit</span>               <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">inverse_transform</span> <span class="o">=</span> <span class="kc">False</span>
                      <span class="p">)</span>
        <span class="n">last_window_values</span><span class="p">,</span> <span class="n">last_window_index</span> <span class="o">=</span> <span class="n">preprocess_last_window</span><span class="p">(</span>
                                                    <span class="n">last_window</span> <span class="o">=</span> <span class="n">last_window</span>
                                                <span class="p">)</span>

        <span class="c1"># Since during predict() `last_window_values` and `exog_values` are modified,</span>
        <span class="c1"># the originals are stored to be used later.</span>
        <span class="n">last_window_values_original</span> <span class="o">=</span> <span class="n">last_window_values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exog_values_original</span> <span class="o">=</span> <span class="n">exog_values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exog_values_original</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recursive_predict</span><span class="p">(</span>
                            <span class="n">steps</span>       <span class="o">=</span> <span class="n">steps</span><span class="p">,</span>
                            <span class="n">level</span>       <span class="o">=</span> <span class="n">level</span><span class="p">,</span>
                            <span class="n">last_window</span> <span class="o">=</span> <span class="n">last_window_values</span><span class="p">,</span>
                            <span class="n">exog</span>        <span class="o">=</span> <span class="n">exog_values</span>
                      <span class="p">)</span>

        <span class="n">predictions_interval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_boot_interval</span><span class="p">(</span>
                                    <span class="n">steps</span>       <span class="o">=</span> <span class="n">steps</span><span class="p">,</span>
                                    <span class="n">level</span>       <span class="o">=</span> <span class="n">level</span><span class="p">,</span>
                                    <span class="n">last_window</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">last_window_values_original</span><span class="p">),</span>
                                    <span class="n">exog</span>        <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">exog_values_original</span><span class="p">),</span>
                                    <span class="n">interval</span>    <span class="o">=</span> <span class="n">interval</span><span class="p">,</span>
                                    <span class="n">n_boot</span>      <span class="o">=</span> <span class="n">n_boot</span><span class="p">,</span>
                                    <span class="n">random_state</span> <span class="o">=</span> <span class="n">random_state</span><span class="p">,</span>
                                    <span class="n">in_sample_residuals</span> <span class="o">=</span> <span class="n">in_sample_residuals</span>
                               <span class="p">)</span>

        <span class="n">predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">predictions</span><span class="p">,</span> <span class="n">predictions_interval</span><span class="p">))</span>

        <span class="n">predictions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">predictions</span><span class="p">,</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="n">expand_index</span><span class="p">(</span>
                                    <span class="n">index</span> <span class="o">=</span> <span class="n">last_window_index</span><span class="p">,</span>
                                    <span class="n">steps</span> <span class="o">=</span> <span class="n">steps</span>
                                <span class="p">),</span>
                        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">,</span> <span class="s1">&#39;lower_bound&#39;</span><span class="p">,</span> <span class="s1">&#39;upper_bound&#39;</span><span class="p">]</span>
                      <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="p">[</span><span class="n">level</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">predictions</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">predictions</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="p">[</span><span class="n">level</span><span class="p">]</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">predictions</span><span class="p">[[</span><span class="n">col</span><span class="p">]])</span>

        <span class="k">return</span> <span class="n">predictions</span>


    <span class="k">def</span> <span class="nf">set_params</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> 
        <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set new values to the parameters of the scikit learn model stored in the</span>
<span class="sd">        ForecasterAutoreg.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : dict</span>
<span class="sd">            Parameters values.</span>

<span class="sd">        Returns </span>
<span class="sd">        -------</span>
<span class="sd">        self</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">regressor</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">set_lags</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> 
        <span class="n">lags</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">range</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;      </span>
<span class="sd">        Set new value to the attribute `lags`.</span>
<span class="sd">        Attributes `max_lag` and `window_size` are also updated.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lags : int, list, 1D np.array, range</span>
<span class="sd">            Lags used as predictors. Index starts at 1, so lag 1 is equal to t-1.</span>
<span class="sd">                `int`: include lags from 1 to `lags`.</span>
<span class="sd">                `list` or `np.array`: include only lags present in `lags`.</span>

<span class="sd">        Returns </span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">lags</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;min value of lags allowed is 1&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">range</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">min</span><span class="p">(</span><span class="n">lags</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;min value of lags allowed is 1&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lags</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">range</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lags</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lags</span> <span class="o">=</span> <span class="n">lags</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;`lags` argument must be `int`, `1D np.ndarray`, `range` or `list`. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">lags</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_lag</span>  <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lags</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">set_out_sample_residuals</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> 
        <span class="n">residuals</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
        <span class="n">level</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">append</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">transform</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span><span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set new values to the attribute `out_sample_residuals`. Out of sample</span>
<span class="sd">        residuals are meant to be calculated using observations that did not</span>
<span class="sd">        participate in the training process.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        residuals : pd.Series</span>
<span class="sd">            Values of residuals. If len(residuals) &gt; 1000, only a random sample</span>
<span class="sd">            of 1000 values are stored.</span>

<span class="sd">        level : str</span>
<span class="sd">            Time series to which the out sample residues belong.</span>

<span class="sd">        append : bool, default `True`</span>
<span class="sd">            If `True`, new residuals are added to the once already stored in the</span>
<span class="sd">            attribute `out_sample_residuals`. Once the limit of 1000 values is</span>
<span class="sd">            reached, no more values are appended. If False, `out_sample_residuals`</span>
<span class="sd">            is overwritten with the new residuals.</span>

<span class="sd">        transform : bool, default `True`</span>
<span class="sd">            If `True`, new residuals are transformed using self.transformer_series.</span>

<span class="sd">        Returns </span>
<span class="sd">        -------</span>
<span class="sd">        self</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;`residuals` argument must be `pd.Series`. Got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">level</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_levels</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;`level` must be one of the `series_levels` : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">series_levels</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">transform</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                Argument `transform` is set to `False` but forecaster was trained</span>
<span class="s1">                using a transformer </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="p">[</span><span class="n">level</span><span class="p">]</span><span class="si">}</span><span class="s1"> for level </span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s1">.</span>
<span class="s1">                Ensure that new residuals are already transformed or set `transform=True`.</span>
<span class="s1">                &#39;&#39;&#39;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">transform</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="p">[</span><span class="n">level</span><span class="p">]:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                Residuals will be transformed using the same transformer used </span>
<span class="s1">                when training the forecaster for level </span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">transformer_y</span><span class="si">}</span><span class="s1">).</span>
<span class="s1">                Ensure that new residuals are in the same scale as the original time</span>
<span class="s1">                series.</span>
<span class="s1">                &#39;&#39;&#39;</span>
            <span class="p">)</span>

            <span class="n">residuals</span> <span class="o">=</span> <span class="n">transform_series</span><span class="p">(</span>
                            <span class="n">series</span>            <span class="o">=</span> <span class="n">residuals</span><span class="p">,</span>
                            <span class="n">transformer</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="p">[</span><span class="n">level</span><span class="p">],</span>
                            <span class="n">fit</span>               <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">inverse_transform</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="p">)</span> 

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
            <span class="n">residuals</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">residuals</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">residuals</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>   

        <span class="k">if</span> <span class="n">append</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_sample_residuals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">free_space</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_sample_residuals</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">free_space</span><span class="p">:</span>
                <span class="n">residuals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">out_sample_residuals</span><span class="p">,</span>
                                <span class="n">residuals</span>
                            <span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">residuals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">out_sample_residuals</span><span class="p">,</span>
                                <span class="n">residuals</span><span class="p">[:</span><span class="n">free_space</span><span class="p">]</span>
                            <span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">out_sample_residuals</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">get_feature_importance</span><span class="p">(</span>
        <span class="bp">self</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;      </span>
<span class="sd">        Return feature importance of the regressor stored in the</span>
<span class="sd">        forecaster. Only valid when regressor stores internally the feature</span>
<span class="sd">        importance in the attribute `feature_importances_` or `coef_`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        self</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        feature_importance : pandas DataFrame</span>
<span class="sd">            Feature importance associated with each predictor.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitted</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NotFittedError</span><span class="p">(</span>
                <span class="s2">&quot;This forecaster is not fitted yet. Call `fit` with appropriate &quot;</span>
                <span class="s2">&quot;arguments before using `get_feature_importance()`.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="p">,</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">):</span>
            <span class="n">estimator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">estimator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regressor</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">feature_importance</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
                                    <span class="s1">&#39;feature&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_train_col_names</span><span class="p">,</span>
                                    <span class="s1">&#39;importance&#39;</span> <span class="p">:</span> <span class="n">estimator</span><span class="o">.</span><span class="n">feature_importances_</span>
                                <span class="p">})</span>
        <span class="k">except</span><span class="p">:</span>   
            <span class="k">try</span><span class="p">:</span>
                <span class="n">feature_importance</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
                                        <span class="s1">&#39;feature&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_train_col_names</span><span class="p">,</span>
                                        <span class="s1">&#39;importance&#39;</span> <span class="p">:</span> <span class="n">estimator</span><span class="o">.</span><span class="n">coef_</span>
                                    <span class="p">})</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Impossible to access feature importance for regressor of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">estimator</span><span class="p">)</span><span class="si">}</span><span class="s2">. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;This method is only valid when the regressor stores internally &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;the feature importance in the attribute `feature_importances_` &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;or `coef_`.&quot;</span>
                <span class="p">)</span>

                <span class="n">feature_importance</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">feature_importance</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h2 id="skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.create_train_X_y" class="doc doc-heading">
<code class="highlight language-python"><span class="n">create_train_X_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">series</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.create_train_X_y" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Create training matrices from univariate time series and exogenous</p>
<p>variables.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>series</code></td>
        <td><code>DataFrame</code></td>
        <td><p>Training time series.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>exog</code></td>
        <td><code>Union[pandas.core.series.Series, pandas.core.frame.DataFrame]</code></td>
        <td><p>Exogenous variable/s included as predictor/s. Must have the same
number of observations as <code>y</code> and their indexes must be aligned.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Tuple[pandas.core.frame.DataFrame, pandas.core.series.Series]</code></td>
      <td><p>Pandas DataFrame with the training values (predictors).</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>skforecast/ForecasterAutoregMultiSeries/ForecasterAutoregMultiSeries.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">create_train_X_y</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">exog</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create training matrices from univariate time series and exogenous</span>
<span class="sd">    variables.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------        </span>
<span class="sd">    series : pandas DataFrame</span>
<span class="sd">        Training time series.</span>

<span class="sd">    exog : pandas Series, pandas DataFrame, default `None`</span>
<span class="sd">        Exogenous variable/s included as predictor/s. Must have the same</span>
<span class="sd">        number of observations as `y` and their indexes must be aligned.</span>

<span class="sd">    Returns </span>
<span class="sd">    -------</span>
<span class="sd">    X_train : pandas DataFrame</span>
<span class="sd">        Pandas DataFrame with the training values (predictors).</span>

<span class="sd">    y_train : pandas Series, shape (len(y) - self.max_lag, )</span>
<span class="sd">        Values (target) of the time series related to each row of `X_train`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;`series` must be a pandas DataFrame.&#39;</span><span class="p">)</span>

    <span class="n">X_levels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">X_train_col_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;lag_</span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lags</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">serie</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>

        <span class="n">y</span> <span class="o">=</span> <span class="n">series</span><span class="p">[</span><span class="n">serie</span><span class="p">]</span>
        <span class="n">check_y</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">transform_series</span><span class="p">(</span>
                <span class="n">series</span>            <span class="o">=</span> <span class="n">y</span><span class="p">,</span>
                <span class="n">transformer</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="p">[</span><span class="n">serie</span><span class="p">],</span>
                <span class="n">fit</span>               <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                <span class="n">inverse_transform</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="p">)</span>
        <span class="n">y_values</span><span class="p">,</span> <span class="n">y_index</span> <span class="o">=</span> <span class="n">preprocess_y</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
        <span class="n">X_train_values</span><span class="p">,</span> <span class="n">y_train_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_lags</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y_values</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train_values</span>
            <span class="n">y_train</span> <span class="o">=</span> <span class="n">y_train_values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_train_values</span><span class="p">))</span>
            <span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_train_values</span><span class="p">)</span>

        <span class="n">X_level</span> <span class="o">=</span> <span class="p">[</span><span class="n">serie</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train_values</span><span class="p">)</span>
        <span class="n">X_levels</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">X_level</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">exog</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">series</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;`exog` must have same number of samples as `series`. &#39;</span>
                <span class="sa">f</span><span class="s1">&#39;length `exog`: (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">exog</span><span class="p">)</span><span class="si">}</span><span class="s1">), length `series`: (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">series</span><span class="p">)</span><span class="si">}</span><span class="s1">)&#39;</span>
            <span class="p">)</span>
        <span class="n">check_exog</span><span class="p">(</span><span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exog</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="n">transform_series</span><span class="p">(</span>
                        <span class="n">series</span>            <span class="o">=</span> <span class="n">exog</span><span class="p">,</span>
                        <span class="n">transformer</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_exog</span><span class="p">,</span>
                        <span class="n">fit</span>               <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="n">inverse_transform</span> <span class="o">=</span> <span class="kc">False</span>
                   <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="n">transform_dataframe</span><span class="p">(</span>
                        <span class="n">df</span>                <span class="o">=</span> <span class="n">exog</span><span class="p">,</span>
                        <span class="n">transformer</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_exog</span><span class="p">,</span>
                        <span class="n">fit</span>               <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="n">inverse_transform</span> <span class="o">=</span> <span class="kc">False</span>
                   <span class="p">)</span>
        <span class="n">exog_values</span><span class="p">,</span> <span class="n">exog_index</span> <span class="o">=</span> <span class="n">preprocess_exog</span><span class="p">(</span><span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">exog_index</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">y_index</span><span class="p">)]</span> <span class="o">==</span> <span class="n">y_index</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="p">(</span><span class="s1">&#39;Different index for `series` and `exog`. They must be equal &#39;</span>
                 <span class="s1">&#39;to ensure the correct alignment of values.&#39;</span><span class="p">)</span>      
            <span class="p">)</span>
        <span class="n">col_names_exog</span> <span class="o">=</span> <span class="n">exog</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exog</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">exog</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="n">X_train_col_names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">col_names_exog</span><span class="p">)</span>

        <span class="c1"># The first `self.max_lag` positions have to be removed from exog</span>
        <span class="c1"># since they are not in X_train. Then exog is cloned as many times</span>
        <span class="c1"># as series.</span>
        <span class="k">if</span> <span class="n">exog_values</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span>
                        <span class="n">X_train</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">exog_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">max_lag</span><span class="p">:,</span> <span class="p">],</span> <span class="n">series</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                      <span class="p">))</span> 

        <span class="k">else</span><span class="p">:</span>
            <span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span>
                        <span class="n">X_train</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">exog_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">max_lag</span><span class="p">:,</span> <span class="p">],</span> <span class="p">[</span><span class="n">series</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span>
                      <span class="p">))</span>

    <span class="n">X_levels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">X_levels</span><span class="p">)</span>
    <span class="n">X_levels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">X_levels</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">X_train_col_names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">X_levels</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_levels</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>

    <span class="n">X_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="n">data</span>    <span class="o">=</span> <span class="n">X_train</span><span class="p">,</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="n">X_train_col_names</span>
            <span class="p">)</span>

    <span class="n">y_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                <span class="n">data</span>  <span class="o">=</span> <span class="n">y_train</span><span class="p">,</span>
                <span class="n">name</span>  <span class="o">=</span> <span class="s1">&#39;y&#39;</span>
            <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">X_train_col_names</span> <span class="o">=</span> <span class="n">X_train_col_names</span>

    <span class="k">return</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_index</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.fit" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">series</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">store_in_sample_residuals</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.fit" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Training Forecaster.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>series</code></td>
        <td><code>DataFrame</code></td>
        <td><p>Training time series.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>exog</code></td>
        <td><code>Union[pandas.core.series.Series, pandas.core.frame.DataFrame]</code></td>
        <td><p>Exogenous variable/s included as predictor/s. Must have the same
number of observations as <code>y</code> and their indexes must be aligned so
that y[i] is regressed on exog[i].</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>store_in_sample_residuals</code></td>
        <td><code>bool</code></td>
        <td><p>if True, in_sample_residuals are stored.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>skforecast/ForecasterAutoregMultiSeries/ForecasterAutoregMultiSeries.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">exog</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">store_in_sample_residuals</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Training Forecaster.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------        </span>
<span class="sd">    series : pandas DataFrame</span>
<span class="sd">        Training time series.</span>

<span class="sd">    exog : pandas Series, pandas DataFrame, default `None`</span>
<span class="sd">        Exogenous variable/s included as predictor/s. Must have the same</span>
<span class="sd">        number of observations as `y` and their indexes must be aligned so</span>
<span class="sd">        that y[i] is regressed on exog[i].</span>

<span class="sd">    store_in_sample_residuals : bool, default `True`</span>
<span class="sd">        if True, in_sample_residuals are stored.</span>

<span class="sd">    Returns </span>
<span class="sd">    -------</span>
<span class="sd">    None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Reset values in case the forecaster has already been fitted.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">index_type</span>           <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">index_freq</span>           <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">index_values</span>         <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_window</span>          <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">included_exog</span>        <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">exog_type</span>            <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">exog_col_names</span>       <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">series_levels</span>        <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">X_train_col_names</span>    <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">in_sample_residuals</span>  <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fitted</span>               <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">training_range</span>       <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">series_levels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dict_transformers</span> <span class="o">=</span> <span class="p">{</span><span class="n">level</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_levels</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span> <span class="o">=</span> <span class="n">dict_transformers</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">dict_transformers</span> <span class="o">=</span> <span class="p">{</span><span class="n">level</span><span class="p">:</span> <span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="p">)</span> 
                             <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_levels</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span> <span class="o">=</span> <span class="n">dict_transformers</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_levels</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;When `transformer_series` parameter is a `dict`, its keys &#39;</span>
                 <span class="sa">f</span><span class="s1">&#39;must be the same as `series_levels` : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">series_levels</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">included_exog</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exog_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">exog</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exog_col_names</span> <span class="o">=</span> \
             <span class="n">exog</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exog</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="k">else</span> <span class="n">exog</span><span class="o">.</span><span class="n">name</span>

    <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_train_X_y</span><span class="p">(</span><span class="n">series</span><span class="o">=</span><span class="n">series</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="p">))</span> <span class="o">==</span> <span class="s2">&quot;&lt;class &#39;xgboost.sklearn.XGBRegressor&#39;&gt;&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">fitted</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fit_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">training_range</span> <span class="o">=</span> <span class="n">y_index</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">index_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">y_index</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y_index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_freq</span> <span class="o">=</span> <span class="n">y_index</span><span class="o">.</span><span class="n">freqstr</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">index_freq</span> <span class="o">=</span> <span class="n">y_index</span><span class="o">.</span><span class="n">step</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">index_values</span> <span class="o">=</span> <span class="n">y_index</span>

    <span class="n">residuals_dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># This is done to save time during fit in functions such as backtesting()</span>
    <span class="k">if</span> <span class="n">store_in_sample_residuals</span><span class="p">:</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="p">))</span> <span class="o">==</span> <span class="s2">&quot;&lt;class &#39;xgboost.sklearn.XGBRegressor&#39;&gt;&quot;</span><span class="p">:</span>
            <span class="n">residuals</span> <span class="o">=</span> <span class="n">y_train</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">residuals</span> <span class="o">=</span> <span class="n">y_train</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">serie</span> <span class="ow">in</span> <span class="n">series</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">residuals_dict</span><span class="p">[</span><span class="n">serie</span><span class="p">]</span> <span class="o">=</span> <span class="n">residuals</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">X_train</span><span class="p">[</span><span class="n">serie</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuals_dict</span><span class="p">[</span><span class="n">serie</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                <span class="c1"># Only up to 1000 residuals are stored</span>
                <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
                <span class="n">residuals_dict</span><span class="p">[</span><span class="n">serie</span><span class="p">]</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
                                            <span class="n">a</span>       <span class="o">=</span> <span class="n">residuals_dict</span><span class="p">[</span><span class="n">serie</span><span class="p">],</span> 
                                            <span class="n">size</span>    <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> 
                                            <span class="n">replace</span> <span class="o">=</span> <span class="kc">False</span>
                                        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">serie</span> <span class="ow">in</span> <span class="n">series</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">residuals_dict</span><span class="p">[</span><span class="n">serie</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">None</span><span class="p">])</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">in_sample_residuals</span> <span class="o">=</span> <span class="n">residuals_dict</span>

    <span class="c1"># The last time window of training data is stored so that lags needed as</span>
    <span class="c1"># predictors in the first iteration of `predict()` can be calculated.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_window</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">max_lag</span><span class="p">:,</span> <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.get_feature_importance" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_feature_importance</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.get_feature_importance" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Return feature importance of the regressor stored in the</p>
<p>forecaster. Only valid when regressor stores internally the feature
importance in the attribute <code>feature_importances_</code> or <code>coef_</code>.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>self</code></td>
        <td><code>None</code></td>
        <td></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>DataFrame</code></td>
      <td><p>Feature importance associated with each predictor.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>skforecast/ForecasterAutoregMultiSeries/ForecasterAutoregMultiSeries.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_importance</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;      </span>
<span class="sd">    Return feature importance of the regressor stored in the</span>
<span class="sd">    forecaster. Only valid when regressor stores internally the feature</span>
<span class="sd">    importance in the attribute `feature_importances_` or `coef_`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    feature_importance : pandas DataFrame</span>
<span class="sd">        Feature importance associated with each predictor.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitted</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NotFittedError</span><span class="p">(</span>
            <span class="s2">&quot;This forecaster is not fitted yet. Call `fit` with appropriate &quot;</span>
            <span class="s2">&quot;arguments before using `get_feature_importance()`.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="p">,</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">):</span>
        <span class="n">estimator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">estimator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regressor</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">feature_importance</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
                                <span class="s1">&#39;feature&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_train_col_names</span><span class="p">,</span>
                                <span class="s1">&#39;importance&#39;</span> <span class="p">:</span> <span class="n">estimator</span><span class="o">.</span><span class="n">feature_importances_</span>
                            <span class="p">})</span>
    <span class="k">except</span><span class="p">:</span>   
        <span class="k">try</span><span class="p">:</span>
            <span class="n">feature_importance</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
                                    <span class="s1">&#39;feature&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_train_col_names</span><span class="p">,</span>
                                    <span class="s1">&#39;importance&#39;</span> <span class="p">:</span> <span class="n">estimator</span><span class="o">.</span><span class="n">coef_</span>
                                <span class="p">})</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Impossible to access feature importance for regressor of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">estimator</span><span class="p">)</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;This method is only valid when the regressor stores internally &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the feature importance in the attribute `feature_importances_` &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;or `coef_`.&quot;</span>
            <span class="p">)</span>

            <span class="n">feature_importance</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">feature_importance</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.predict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">last_window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.predict" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Predict n steps ahead. It is an recursive process in which, each prediction,</p>
<p>is used as a predictor for the next step.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>steps</code></td>
        <td><code>int</code></td>
        <td><p>Number of future steps predicted.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>level</code></td>
        <td><code>str</code></td>
        <td><p>Time series to be predicted.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>last_window</code></td>
        <td><code>Optional[pandas.core.frame.DataFrame]</code></td>
        <td><p>Values of the series used to create the predictors (lags) need in the 
first iteration of prediction (t + 1).</p>
<p>If <code>last_window = None</code>, the values stored in <code>self.last_window</code> are
used to calculate the initial predictors, and the predictions start
right after training data.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>exog</code></td>
        <td><code>Union[pandas.core.series.Series, pandas.core.frame.DataFrame]</code></td>
        <td><p>Exogenous variable/s included as predictor/s.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Series</code></td>
      <td><p>Predicted values.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>skforecast/ForecasterAutoregMultiSeries/ForecasterAutoregMultiSeries.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">steps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">level</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">last_window</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">exog</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Predict n steps ahead. It is an recursive process in which, each prediction,</span>
<span class="sd">    is used as a predictor for the next step.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    steps : int</span>
<span class="sd">        Number of future steps predicted.</span>

<span class="sd">    level : str</span>
<span class="sd">        Time series to be predicted.</span>

<span class="sd">    last_window : pandas DataFrame, default `None`</span>
<span class="sd">        Values of the series used to create the predictors (lags) need in the </span>
<span class="sd">        first iteration of prediction (t + 1).</span>

<span class="sd">        If `last_window = None`, the values stored in `self.last_window` are</span>
<span class="sd">        used to calculate the initial predictors, and the predictions start</span>
<span class="sd">        right after training data.</span>

<span class="sd">    exog : pandas Series, pandas DataFrame, default `None`</span>
<span class="sd">        Exogenous variable/s included as predictor/s.</span>

<span class="sd">    Returns </span>
<span class="sd">    -------</span>
<span class="sd">    predictions : pandas Series</span>
<span class="sd">        Predicted values.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_predict_input</span><span class="p">(</span>
        <span class="n">forecaster_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
        <span class="n">steps</span>           <span class="o">=</span> <span class="n">steps</span><span class="p">,</span>
        <span class="n">fitted</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitted</span><span class="p">,</span>
        <span class="n">included_exog</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">included_exog</span><span class="p">,</span>
        <span class="n">index_type</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_type</span><span class="p">,</span>
        <span class="n">index_freq</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_freq</span><span class="p">,</span>
        <span class="n">window_size</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">,</span>
        <span class="n">last_window</span>     <span class="o">=</span> <span class="n">last_window</span><span class="p">,</span>
        <span class="n">exog</span>            <span class="o">=</span> <span class="n">exog</span><span class="p">,</span>
        <span class="n">exog_type</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog_type</span><span class="p">,</span>
        <span class="n">exog_col_names</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog_col_names</span><span class="p">,</span>
        <span class="n">interval</span>        <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_steps</span>       <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">level</span>           <span class="o">=</span> <span class="n">level</span><span class="p">,</span>
        <span class="n">series_levels</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_levels</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exog</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="n">transform_dataframe</span><span class="p">(</span>
                        <span class="n">df</span>                <span class="o">=</span> <span class="n">exog</span><span class="p">,</span>
                        <span class="n">transformer</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_exog</span><span class="p">,</span>
                        <span class="n">fit</span>               <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">inverse_transform</span> <span class="o">=</span> <span class="kc">False</span>
                   <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="n">transform_series</span><span class="p">(</span>
                        <span class="n">series</span>            <span class="o">=</span> <span class="n">exog</span><span class="p">,</span>
                        <span class="n">transformer</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_exog</span><span class="p">,</span>
                        <span class="n">fit</span>               <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">inverse_transform</span> <span class="o">=</span> <span class="kc">False</span>
                   <span class="p">)</span>

        <span class="n">exog_values</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">preprocess_exog</span><span class="p">(</span>
                            <span class="n">exog</span> <span class="o">=</span> <span class="n">exog</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">steps</span><span class="p">,</span> <span class="p">]</span>
                         <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">exog_values</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">last_window</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">last_window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_window</span><span class="p">[</span><span class="n">level</span><span class="p">]</span>

    <span class="n">last_window</span> <span class="o">=</span> <span class="n">transform_series</span><span class="p">(</span>
                        <span class="n">series</span>            <span class="o">=</span> <span class="n">last_window</span><span class="p">,</span>
                        <span class="n">transformer</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="p">[</span><span class="n">level</span><span class="p">],</span>
                        <span class="n">fit</span>               <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">inverse_transform</span> <span class="o">=</span> <span class="kc">False</span>
                  <span class="p">)</span>
    <span class="n">last_window_values</span><span class="p">,</span> <span class="n">last_window_index</span> <span class="o">=</span> <span class="n">preprocess_last_window</span><span class="p">(</span>
                                                <span class="n">last_window</span> <span class="o">=</span> <span class="n">last_window</span>
                                            <span class="p">)</span>

    <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recursive_predict</span><span class="p">(</span>
                    <span class="n">steps</span>       <span class="o">=</span> <span class="n">steps</span><span class="p">,</span>
                    <span class="n">level</span>       <span class="o">=</span> <span class="n">level</span><span class="p">,</span>
                    <span class="n">last_window</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">last_window_values</span><span class="p">),</span>
                    <span class="n">exog</span>        <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">exog_values</span><span class="p">)</span>
                  <span class="p">)</span>

    <span class="n">predictions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                    <span class="n">data</span>  <span class="o">=</span> <span class="n">predictions</span><span class="p">,</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">expand_index</span><span class="p">(</span>
                                <span class="n">index</span> <span class="o">=</span> <span class="n">last_window_index</span><span class="p">,</span>
                                <span class="n">steps</span> <span class="o">=</span> <span class="n">steps</span>
                            <span class="p">),</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;pred&#39;</span>
                  <span class="p">)</span>

    <span class="n">predictions</span> <span class="o">=</span> <span class="n">transform_series</span><span class="p">(</span>
                    <span class="n">series</span>            <span class="o">=</span> <span class="n">predictions</span><span class="p">,</span>
                    <span class="n">transformer</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="p">[</span><span class="n">level</span><span class="p">],</span>
                    <span class="n">fit</span>               <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="n">inverse_transform</span> <span class="o">=</span> <span class="kc">True</span>
                  <span class="p">)</span>

    <span class="k">return</span> <span class="n">predictions</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.predict_interval" class="doc doc-heading">
<code class="highlight language-python"><span class="n">predict_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">last_window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">95</span><span class="p">],</span> <span class="n">n_boot</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">in_sample_residuals</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.predict_interval" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Iterative process in which, each prediction, is used as a predictor</p>
<p>for the next step and bootstrapping is used to estimate prediction
intervals. Both, predictions and intervals, are returned.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>steps</code></td>
        <td><code>int</code></td>
        <td><p>Number of future steps predicted.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>level</code></td>
        <td><code>str</code></td>
        <td><p>Time series to be predicted.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>last_window</code></td>
        <td><code>Optional[pandas.core.frame.DataFrame]</code></td>
        <td><p>Values of the series used to create the predictors (lags) needed in the 
first iteration of prediction (t + 1).</p>
<p>If <code>last_window = None</code>, the values stored in<code>self.last_window</code> are
used to calculate the initial predictors, and the predictions start
right after training data.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>exog</code></td>
        <td><code>Union[pandas.core.series.Series, pandas.core.frame.DataFrame]</code></td>
        <td><p>Exogenous variable/s included as predictor/s.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>interval</code></td>
        <td><code>list</code></td>
        <td><p>Confidence of the prediction interval estimated. Sequence of 
percentiles to compute, which must be between 0 and 100 inclusive. 
For example, interval of 95% should be as <code>interval = [2.5, 97.5]</code>.</p></td>
        <td><code>[5, 95]</code></td>
      </tr>
      <tr>
        <td><code>n_boot</code></td>
        <td><code>int</code></td>
        <td><p>Number of bootstrapping iterations used to estimate prediction
intervals.</p></td>
        <td><code>500</code></td>
      </tr>
      <tr>
        <td><code>random_state</code></td>
        <td><code>int</code></td>
        <td><p>Sets a seed to the random generator, so that boot intervals are always 
deterministic.</p></td>
        <td><code>123</code></td>
      </tr>
      <tr>
        <td><code>in_sample_residuals</code></td>
        <td><code>bool</code></td>
        <td><p>If <code>True</code>, residuals from the training data are used as proxy of
prediction error to create prediction intervals. If <code>False</code>, out of
sample residuals are used. In the latter case, the user should have
calculated and stored the residuals within the forecaster (see
<code>set_out_sample_residuals()</code>).</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>DataFrame</code></td>
      <td><p>Values predicted by the forecaster and their estimated interval:
    column pred = predictions.
    column lower_bound = lower bound of the interval.
    column upper_bound = upper bound interval of the interval.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>skforecast/ForecasterAutoregMultiSeries/ForecasterAutoregMultiSeries.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">predict_interval</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">steps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">level</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">last_window</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">exog</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">interval</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">95</span><span class="p">],</span>
    <span class="n">n_boot</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span>
    <span class="n">in_sample_residuals</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterative process in which, each prediction, is used as a predictor</span>
<span class="sd">    for the next step and bootstrapping is used to estimate prediction</span>
<span class="sd">    intervals. Both, predictions and intervals, are returned.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ---------- </span>
<span class="sd">    steps : int</span>
<span class="sd">        Number of future steps predicted.</span>

<span class="sd">    level : str</span>
<span class="sd">        Time series to be predicted.        </span>

<span class="sd">    last_window : pandas DataFrame, default `None`</span>
<span class="sd">        Values of the series used to create the predictors (lags) needed in the </span>
<span class="sd">        first iteration of prediction (t + 1).</span>

<span class="sd">        If `last_window = None`, the values stored in` self.last_window` are</span>
<span class="sd">        used to calculate the initial predictors, and the predictions start</span>
<span class="sd">        right after training data.</span>

<span class="sd">    exog : pandas Series, pandas DataFrame, default `None`</span>
<span class="sd">        Exogenous variable/s included as predictor/s.</span>

<span class="sd">    interval : list, default `[5, 95]`</span>
<span class="sd">        Confidence of the prediction interval estimated. Sequence of </span>
<span class="sd">        percentiles to compute, which must be between 0 and 100 inclusive. </span>
<span class="sd">        For example, interval of 95% should be as `interval = [2.5, 97.5]`.</span>

<span class="sd">    n_boot : int, default `500`</span>
<span class="sd">        Number of bootstrapping iterations used to estimate prediction</span>
<span class="sd">        intervals.</span>

<span class="sd">    random_state : int, default 123</span>
<span class="sd">        Sets a seed to the random generator, so that boot intervals are always </span>
<span class="sd">        deterministic.</span>

<span class="sd">    in_sample_residuals : bool, default `True`</span>
<span class="sd">        If `True`, residuals from the training data are used as proxy of</span>
<span class="sd">        prediction error to create prediction intervals. If `False`, out of</span>
<span class="sd">        sample residuals are used. In the latter case, the user should have</span>
<span class="sd">        calculated and stored the residuals within the forecaster (see</span>
<span class="sd">        `set_out_sample_residuals()`).</span>

<span class="sd">    Returns </span>
<span class="sd">    -------</span>
<span class="sd">    predictions : pandas DataFrame</span>
<span class="sd">        Values predicted by the forecaster and their estimated interval:</span>
<span class="sd">            column pred = predictions.</span>
<span class="sd">            column lower_bound = lower bound of the interval.</span>
<span class="sd">            column upper_bound = upper bound interval of the interval.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    More information about prediction intervals in forecasting:</span>
<span class="sd">    https://otexts.com/fpp2/prediction-intervals.html</span>
<span class="sd">    Forecasting: Principles and Practice (2nd ed) Rob J Hyndman and</span>
<span class="sd">    George Athanasopoulos.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">in_sample_residuals</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_sample_residuals</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="p">(</span><span class="s1">&#39;`forecaster.in_sample_residuals[level]` contains `None` values. &#39;</span>
             <span class="s1">&#39;Try using `fit` method with `in_sample_residuals=True` or set in &#39;</span>
             <span class="s1">&#39;`predict_interval` method `in_sample_residuals=False` and use &#39;</span>
             <span class="s1">&#39;`out_sample_residuals` (see `set_out_sample_residuals()`).&#39;</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">check_predict_input</span><span class="p">(</span>
        <span class="n">forecaster_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
        <span class="n">steps</span>           <span class="o">=</span> <span class="n">steps</span><span class="p">,</span>
        <span class="n">fitted</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitted</span><span class="p">,</span>
        <span class="n">included_exog</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">included_exog</span><span class="p">,</span>
        <span class="n">index_type</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_type</span><span class="p">,</span>
        <span class="n">index_freq</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_freq</span><span class="p">,</span>
        <span class="n">window_size</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">,</span>
        <span class="n">last_window</span>     <span class="o">=</span> <span class="n">last_window</span><span class="p">,</span>
        <span class="n">exog</span>            <span class="o">=</span> <span class="n">exog</span><span class="p">,</span>
        <span class="n">exog_type</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog_type</span><span class="p">,</span>
        <span class="n">exog_col_names</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog_col_names</span><span class="p">,</span>
        <span class="n">interval</span>        <span class="o">=</span> <span class="n">interval</span><span class="p">,</span>
        <span class="n">max_steps</span>       <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">level</span>           <span class="o">=</span> <span class="n">level</span><span class="p">,</span>
        <span class="n">series_levels</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_levels</span>
    <span class="p">)</span> 

    <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exog</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="n">transform_dataframe</span><span class="p">(</span>
                        <span class="n">df</span>                <span class="o">=</span> <span class="n">exog</span><span class="p">,</span>
                        <span class="n">transformer</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_exog</span><span class="p">,</span>
                        <span class="n">fit</span>               <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">inverse_transform</span> <span class="o">=</span> <span class="kc">False</span>
                   <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="n">transform_series</span><span class="p">(</span>
                        <span class="n">series</span>            <span class="o">=</span> <span class="n">exog</span><span class="p">,</span>
                        <span class="n">transformer</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_exog</span><span class="p">,</span>
                        <span class="n">fit</span>               <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">inverse_transform</span> <span class="o">=</span> <span class="kc">False</span>
                   <span class="p">)</span>

        <span class="n">exog_values</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">preprocess_exog</span><span class="p">(</span>
                            <span class="n">exog</span> <span class="o">=</span> <span class="n">exog</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">steps</span><span class="p">,</span> <span class="p">]</span>
                            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">exog_values</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">last_window</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">last_window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_window</span><span class="p">[</span><span class="n">level</span><span class="p">]</span>

    <span class="n">last_window</span> <span class="o">=</span> <span class="n">transform_series</span><span class="p">(</span>
                        <span class="n">series</span>            <span class="o">=</span> <span class="n">last_window</span><span class="p">,</span>
                        <span class="n">transformer</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="p">[</span><span class="n">level</span><span class="p">],</span>
                        <span class="n">fit</span>               <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">inverse_transform</span> <span class="o">=</span> <span class="kc">False</span>
                  <span class="p">)</span>
    <span class="n">last_window_values</span><span class="p">,</span> <span class="n">last_window_index</span> <span class="o">=</span> <span class="n">preprocess_last_window</span><span class="p">(</span>
                                                <span class="n">last_window</span> <span class="o">=</span> <span class="n">last_window</span>
                                            <span class="p">)</span>

    <span class="c1"># Since during predict() `last_window_values` and `exog_values` are modified,</span>
    <span class="c1"># the originals are stored to be used later.</span>
    <span class="n">last_window_values_original</span> <span class="o">=</span> <span class="n">last_window_values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">exog_values_original</span> <span class="o">=</span> <span class="n">exog_values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">exog_values_original</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recursive_predict</span><span class="p">(</span>
                        <span class="n">steps</span>       <span class="o">=</span> <span class="n">steps</span><span class="p">,</span>
                        <span class="n">level</span>       <span class="o">=</span> <span class="n">level</span><span class="p">,</span>
                        <span class="n">last_window</span> <span class="o">=</span> <span class="n">last_window_values</span><span class="p">,</span>
                        <span class="n">exog</span>        <span class="o">=</span> <span class="n">exog_values</span>
                  <span class="p">)</span>

    <span class="n">predictions_interval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_boot_interval</span><span class="p">(</span>
                                <span class="n">steps</span>       <span class="o">=</span> <span class="n">steps</span><span class="p">,</span>
                                <span class="n">level</span>       <span class="o">=</span> <span class="n">level</span><span class="p">,</span>
                                <span class="n">last_window</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">last_window_values_original</span><span class="p">),</span>
                                <span class="n">exog</span>        <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">exog_values_original</span><span class="p">),</span>
                                <span class="n">interval</span>    <span class="o">=</span> <span class="n">interval</span><span class="p">,</span>
                                <span class="n">n_boot</span>      <span class="o">=</span> <span class="n">n_boot</span><span class="p">,</span>
                                <span class="n">random_state</span> <span class="o">=</span> <span class="n">random_state</span><span class="p">,</span>
                                <span class="n">in_sample_residuals</span> <span class="o">=</span> <span class="n">in_sample_residuals</span>
                           <span class="p">)</span>

    <span class="n">predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">predictions</span><span class="p">,</span> <span class="n">predictions_interval</span><span class="p">))</span>

    <span class="n">predictions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">predictions</span><span class="p">,</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">expand_index</span><span class="p">(</span>
                                <span class="n">index</span> <span class="o">=</span> <span class="n">last_window_index</span><span class="p">,</span>
                                <span class="n">steps</span> <span class="o">=</span> <span class="n">steps</span>
                            <span class="p">),</span>
                    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">,</span> <span class="s1">&#39;lower_bound&#39;</span><span class="p">,</span> <span class="s1">&#39;upper_bound&#39;</span><span class="p">]</span>
                  <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="p">[</span><span class="n">level</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">predictions</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">predictions</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="p">[</span><span class="n">level</span><span class="p">]</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">predictions</span><span class="p">[[</span><span class="n">col</span><span class="p">]])</span>

    <span class="k">return</span> <span class="n">predictions</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.set_lags" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_lags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lags</span><span class="p">)</span></code>


<a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.set_lags" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Set new value to the attribute <code>lags</code>.</p>
<p>Attributes <code>max_lag</code> and <code>window_size</code> are also updated.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>lags</code></td>
        <td><code>Union[int, list, numpy.ndarray, range]</code></td>
        <td><p>Lags used as predictors. Index starts at 1, so lag 1 is equal to t-1.
    <code>int</code>: include lags from 1 to <code>lags</code>.
    <code>list</code> or <code>np.array</code>: include only lags present in <code>lags</code>.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>skforecast/ForecasterAutoregMultiSeries/ForecasterAutoregMultiSeries.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">set_lags</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> 
    <span class="n">lags</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">range</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;      </span>
<span class="sd">    Set new value to the attribute `lags`.</span>
<span class="sd">    Attributes `max_lag` and `window_size` are also updated.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lags : int, list, 1D np.array, range</span>
<span class="sd">        Lags used as predictors. Index starts at 1, so lag 1 is equal to t-1.</span>
<span class="sd">            `int`: include lags from 1 to `lags`.</span>
<span class="sd">            `list` or `np.array`: include only lags present in `lags`.</span>

<span class="sd">    Returns </span>
<span class="sd">    -------</span>
<span class="sd">    None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">lags</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;min value of lags allowed is 1&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">range</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">min</span><span class="p">(</span><span class="n">lags</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;min value of lags allowed is 1&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lags</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">range</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lags</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lags</span> <span class="o">=</span> <span class="n">lags</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;`lags` argument must be `int`, `1D np.ndarray`, `range` or `list`. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">lags</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">max_lag</span>  <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lags</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lags</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.set_out_sample_residuals" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_out_sample_residuals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.set_out_sample_residuals" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Set new values to the attribute <code>out_sample_residuals</code>. Out of sample</p>
<p>residuals are meant to be calculated using observations that did not
participate in the training process.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>residuals</code></td>
        <td><code>Series</code></td>
        <td><p>Values of residuals. If len(residuals) &gt; 1000, only a random sample
of 1000 values are stored.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>level</code></td>
        <td><code>str</code></td>
        <td><p>Time series to which the out sample residues belong.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>append</code></td>
        <td><code>bool</code></td>
        <td><p>If <code>True</code>, new residuals are added to the once already stored in the
attribute <code>out_sample_residuals</code>. Once the limit of 1000 values is
reached, no more values are appended. If False, <code>out_sample_residuals</code>
is overwritten with the new residuals.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>transform</code></td>
        <td><code>bool</code></td>
        <td><p>If <code>True</code>, new residuals are transformed using self.transformer_series.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>skforecast/ForecasterAutoregMultiSeries/ForecasterAutoregMultiSeries.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">set_out_sample_residuals</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> 
    <span class="n">residuals</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
    <span class="n">level</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">append</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">transform</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span><span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set new values to the attribute `out_sample_residuals`. Out of sample</span>
<span class="sd">    residuals are meant to be calculated using observations that did not</span>
<span class="sd">    participate in the training process.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    residuals : pd.Series</span>
<span class="sd">        Values of residuals. If len(residuals) &gt; 1000, only a random sample</span>
<span class="sd">        of 1000 values are stored.</span>

<span class="sd">    level : str</span>
<span class="sd">        Time series to which the out sample residues belong.</span>

<span class="sd">    append : bool, default `True`</span>
<span class="sd">        If `True`, new residuals are added to the once already stored in the</span>
<span class="sd">        attribute `out_sample_residuals`. Once the limit of 1000 values is</span>
<span class="sd">        reached, no more values are appended. If False, `out_sample_residuals`</span>
<span class="sd">        is overwritten with the new residuals.</span>

<span class="sd">    transform : bool, default `True`</span>
<span class="sd">        If `True`, new residuals are transformed using self.transformer_series.</span>

<span class="sd">    Returns </span>
<span class="sd">    -------</span>
<span class="sd">    self</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;`residuals` argument must be `pd.Series`. Got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">level</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_levels</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;`level` must be one of the `series_levels` : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">series_levels</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">transform</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            Argument `transform` is set to `False` but forecaster was trained</span>
<span class="s1">            using a transformer </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="p">[</span><span class="n">level</span><span class="p">]</span><span class="si">}</span><span class="s1"> for level </span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s1">.</span>
<span class="s1">            Ensure that new residuals are already transformed or set `transform=True`.</span>
<span class="s1">            &#39;&#39;&#39;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">transform</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="p">[</span><span class="n">level</span><span class="p">]:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            Residuals will be transformed using the same transformer used </span>
<span class="s1">            when training the forecaster for level </span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">transformer_y</span><span class="si">}</span><span class="s1">).</span>
<span class="s1">            Ensure that new residuals are in the same scale as the original time</span>
<span class="s1">            series.</span>
<span class="s1">            &#39;&#39;&#39;</span>
        <span class="p">)</span>

        <span class="n">residuals</span> <span class="o">=</span> <span class="n">transform_series</span><span class="p">(</span>
                        <span class="n">series</span>            <span class="o">=</span> <span class="n">residuals</span><span class="p">,</span>
                        <span class="n">transformer</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_series</span><span class="p">[</span><span class="n">level</span><span class="p">],</span>
                        <span class="n">fit</span>               <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">inverse_transform</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="p">)</span> 

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
        <span class="n">residuals</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">residuals</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">residuals</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>   

    <span class="k">if</span> <span class="n">append</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_sample_residuals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">free_space</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_sample_residuals</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">free_space</span><span class="p">:</span>
            <span class="n">residuals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">out_sample_residuals</span><span class="p">,</span>
                            <span class="n">residuals</span>
                        <span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">residuals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">out_sample_residuals</span><span class="p">,</span>
                            <span class="n">residuals</span><span class="p">[:</span><span class="n">free_space</span><span class="p">]</span>
                        <span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">out_sample_residuals</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.set_params" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></code>


<a href="#skforecast.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.ForecasterAutoregMultiSeries.set_params" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Set new values to the parameters of the scikit learn model stored in the</p>
<p>ForecasterAutoreg.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>params</code></td>
        <td><code>dict</code></td>
        <td><p>Parameters values.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>skforecast/ForecasterAutoregMultiSeries/ForecasterAutoregMultiSeries.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">set_params</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> 
    <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="nb">dict</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set new values to the parameters of the scikit learn model stored in the</span>
<span class="sd">    ForecasterAutoreg.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    params : dict</span>
<span class="sd">        Parameters values.</span>

<span class="sd">    Returns </span>
<span class="sd">    -------</span>
<span class="sd">    self</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">regressor</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">regressor</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>


  




                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="ForecasterAutoregDirect.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: ForecasterAutoregDirect" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              ForecasterAutoregDirect
            </div>
          </div>
        </a>
      
      
        
        <a href="model_selection.html" class="md-footer__link md-footer__link--next" aria-label="Next: model_selection" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              model_selection
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  


  
    
  



  

<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input type="checkbox" class="md-toggle" id="__settings">
<div class="md-consent__settings">
  <ul class="task-list">
    
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        <label>
      </li>
    
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="github" checked>
          <span class="task-list-indicator"></span>
          GitHub
        <label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);console.log(new FormData(form)),__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.top"], "search": "../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.37e9125f.min.js"></script>
      
    
  </body>
</html>